{
  "$schema": "https://railway.app/railway.schema.json",
  "name": "Maison De Valeur Monorepo",
  "services": [
    {
      "name": "mdv-api",
      "source": {
        "repo": ".",
        "branch": "main"
      },
      "build": {
        "builder": "DOCKERFILE",
        "dockerfilePath": "Dockerfile.backend"
      },
      "deploy": {
        "startCommand": "python backend/start.py",
        "restartPolicyType": "ON_FAILURE",
        "restartPolicyMaxRetries": 10,
        "healthcheckPath": "/health",
        "healthcheckTimeout": 300,
        "numReplicas": 1
      },
      "resources": {
        "memoryLimit": 2048,
        "cpuLimit": 1000,
        "diskSizeGB": 10
      },
      "envs": [
        "ENV",
        "APP_URL",
        "DATABASE_URL",
        "REDIS_URL",
        "PAYSTACK_PUBLIC_KEY",
        "PAYSTACK_SECRET_KEY",
        "RESEND_API_KEY",
        "CLOUDINARY_URL",
        "JWT_SECRET",
        "OTEL_EXPORTER_OTLP_ENDPOINT",
        "SENTRY_DSN"
      ]
    },
    {
      "name": "mdv-worker",
      "source": {
        "repo": ".",
        "branch": "main"
      },
      "build": {
        "builder": "DOCKERFILE",
        "dockerfilePath": "Dockerfile.backend"
      },
      "deploy": {
        "startCommand": "python backend/start_worker.py",
        "restartPolicyType": "ON_FAILURE",
        "restartPolicyMaxRetries": 10,
        "numReplicas": 1
      },
      "resources": {
        "memoryLimit": 1024,
        "cpuLimit": 500,
        "diskSizeGB": 5
      },
      "envs": [
        "ENV",
        "DATABASE_URL",
        "REDIS_URL",
        "JWT_SECRET",
        "RESEND_API_KEY",
        "OTEL_EXPORTER_OTLP_ENDPOINT",
        "SENTRY_DSN"
      ]
    },
    {
      "name": "mdv-postgres",
      "managed": true
    },
    {
        "name": "mdv-redis",
        "managed": true
    },
    {
        "name": "mdv-web",
        "source": {
          "repo": ".",
          "branch": "main"
        },
        "build": {
          "builder": "DOCKERFILE",
          "dockerfilePath": "Dockerfile.web",
          "buildCommand": null,
          "watchPatterns": ["web/**", "docs/api-contracts.yaml", "Dockerfile.web"],
          "buildArgs": {
            "NEXT_PUBLIC_API_URL": "$NEXT_PUBLIC_API_URL",
            "NEXT_PUBLIC_APP_URL": "$NEXT_PUBLIC_APP_URL",
            "NEXT_PUBLIC_PAYSTACK_PUBLIC_KEY": "$NEXT_PUBLIC_PAYSTACK_PUBLIC_KEY"
          },
          "buildTimeout": 1200
        },
        "deploy": {
          "startCommand": "node server.js",
          "restartPolicyType": "ON_FAILURE",
          "restartPolicyMaxRetries": 10,
          "healthcheckPath": "/",
          "healthcheckTimeout": 300,
          "numReplicas": 1
        },
        "resources": {
          "memoryLimit": 2048,
          "cpuLimit": 1000,
          "diskSizeGB": 10
        },
        "envs": [
          "NEXT_PUBLIC_API_URL",
          "NEXT_PUBLIC_APP_URL",
          "ALLOW_MOCKS",
          "NEXT_PUBLIC_ALLOW_MOCKS",
          "NEXT_PUBLIC_PAYSTACK_PUBLIC_KEY"
        ]
    }
  ]
}

